# Markdown Task Format - Complete Reference

## タグ仕様

### ステータスタグ

| タグ | 状態 | 説明 |
|------|------|------|
| `[]` | 未着手 | まだ開始していないタスク |
| `[-]` | 進行中 | 現在作業中のタスク |
| `[x]` | 完了 | 完了したタスク |

### 構文規則

- タグは行頭（インデント後）に配置
- タグとタスク内容の間は1スペース
- タスク内容は1行で記述

```
{インデント}[{ステータス}] {タスク内容}
```

## 階層構造仕様

### インデント

- 1レベル = 2スペース
- タブは非推奨（スペースに統一）

### 親子関係

```markdown
[] 親タスク (レベル0)
  [] 子タスク1 (レベル1)
  [] 子タスク2 (レベル1)
    [] 孫タスク (レベル2)
```

### 依存関係の推論

1. **順序依存**: 同レベルの前のタスクが完了していない場合，依存とみなす
2. **階層依存**: 子タスクは親タスクの一部
3. **明示的依存**: タスク内容に「{他タスク}の後」と記載で明示

## ファイル構造

### 必須セクション

```markdown
# Task
{タスク一覧}
```

### 推奨セクション

```markdown
# 概要
{プロジェクト/タスクの説明}

# Task
{タスク一覧}

# 作業ログ
{作業記録が追記される}
```

## 作業ログ仕様

### ログエントリ形式

```markdown
#### {日時} - {作業タイトル}
{作業内容の箇条書き}
```

### 日時フォーマット

`YYYY-MM-DD HH:MM`

例: `2024-01-05 10:30`

### 作業内容の記載

```markdown
#### 2024-01-05 10:30 - 機能Aの実装
- task-implementerエージェントを起動
- 以下のファイルを作成:
  - `src/feature-a.ts`
  - `src/feature-a.test.ts`
- テスト結果: 全件パス

実行コマンド:
```bash
npm test src/feature-a.test.ts
```
```

## タスク更新規則

### 自動更新

1. タスク開始時に `[]` → `[-]`
2. タスク完了時に `[-]` → `[x]`
3. 全子タスク完了時に親も `[x]`

### 手動更新のみ

- タスクの追加
- タスクの削除
- タスク内容の変更

## パース用正規表現

### タスク行の検出

```regex
^(\s*)\[([ x-])\]\s+(.+)$
```

- キャプチャ1: インデント
- キャプチャ2: ステータス文字
- キャプチャ3: タスク内容

### インデントレベルの計算

インデントのスペース数を2で割ったものがレベル:
- 0スペース → レベル0
- 2スペース → レベル1
- 4スペース → レベル2

### セクション見出しの検出

```regex
^#+\s+(.+)$
```

## 完全なファイル例

```markdown
# 概要
新しいユーザー認証機能を実装する．
OAuth2.0対応とセッション管理を含む．

# 説明
タグ
- タスク未遂：[]
- タスク遂行中：[-]
- タスク完了：[x]

どのような作業をしたかのメモを適宜このファイルに記入してください．

# Task
[-] ユーザー認証機能を実装する
  [x] 設計ドキュメント作成
  [-] バックエンド実装
    [x] データベーススキーマ設計
    [-] APIエンドポイント実装
    [] ユニットテスト作成
  [] フロントエンド実装
    [] ログインフォーム
    [] セッション管理
  [] 結合テスト

# 作業ログ

#### 2024-01-05 09:00 - 設計開始
- 要件を確認
- データベーススキーマを設計
- `docs/auth-design.md` を作成

#### 2024-01-05 10:30 - スキーマ実装
- task-implementerエージェントを起動
- `prisma/schema.prisma` にUserモデルを追加
- マイグレーション実行

```bash
npx prisma migrate dev --name add-user-model
```

#### 2024-01-05 11:00 - API実装開始
- `/api/auth/login` エンドポイントの実装開始
- JWTトークン生成ロジックを追加
```

## エラーケース

### 無効なタスク形式

```markdown
# 無効な例
[ ] タスク      # スペースが不正
[X] タスク      # 大文字X
[?] タスク      # 不明なステータス
タスク          # タグなし
```

### 曖昧なインデント

```markdown
# 曖昧な例（避けるべき）
[] 親タスク
   [] 子タスク  # 3スペース（奇数）は曖昧
```

## ベストプラクティス

1. **タスクは具体的に**: 「〜を実装する」より「〜機能の〜部分を実装する」
2. **適切な粒度**: 1タスク = 1-2時間程度の作業量
3. **依存関係を明確に**: 順序が重要なら明示的に記載
4. **ログは詳細に**: 後から振り返れる程度の情報量
5. **定期的な更新**: ステータスは作業の都度更新
